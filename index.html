<!doctype html>
<html>

<head>
    <title>Angular analytics test</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.5/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.5/angular-sanitize.min.js"></script>
    <!-- https://github.com/revolunet/angular-google-analytics -->
    <script src="angular-google-analytics.min.js"></script>
</head>
</head>

<body ng-app="gaApp">
    <div ng-controller="gaCtrl">
        <video controls ng-src="{{trust(gaModel.videoUrl)}}" on-play="onPlay()" on-pause="onPause()"></video>
    </div>
    <script type="text/javascript">
    var app = angular.module('gaApp', ['angular-google-analytics']);

    app.config(function(AnalyticsProvider) {
        const CONFIG = {
            trackingId: 'UA-83738763-1'
        };
        AnalyticsProvider.useAnalytics(true);
        AnalyticsProvider.setAccount({
            tracker: CONFIG.trackingId,
            trackEvent: true
        });
    });

    // As an example, add the service to the run call:
    app.run(function(Analytics) {});

    // Main controller
    app.controller('gaCtrl', ['$scope', '$sce', 'Analytics', function($scope, $sce, Analytics) {

        $scope.gaModel = {
            gaText: '',
            videoUrl: 'http://www.sample-videos.com/video/mp4/720/big_buck_bunny_720p_1mb.mp4'
        };

        $scope.trust = function(url) {
            return $sce.trustAsResourceUrl(url);
        };

        $scope.onPlay = function() {
            console.log("Sending play event.");
            Analytics.trackEvent('video', 'play', 'big_buck_bunny_720p_1mb.mp4');
        };

        $scope.onPause = function() {
            console.log("Sending pause event.");
            Analytics.trackEvent('video', 'pause', 'big_buck_bunny_720p_1mb.mp4');
        };

        Analytics.pageView();
    }]);

	// Video play/pause control directive
    app.directive('video', function() {
        return {
            restrict: "E",
            scope: {
                onPlay: '&',
                onPause: '&'
            },
            link: function(scope, elem) {

                var isPlaying = false;

                elem.bind('play', function(evt) {
                    isPlaying = true;
                    if (scope.onPlay) {
                        scope.onPlay(evt);
                    }
                    console.log('Playing...');
                });

                elem.bind('pause ended', function(evt) {
                    isPlaying = true;
                    if (scope.onPause) {
                        scope.onPause(evt);
                    }
                    console.log('Paused...');
                });

                console.log('Video directive initialized.');
            }
        };
    });
    </script>
    <style type="text/css">
    video {
        width: 600px;
        height: 400px;
    }
    </style>
</body>

</html>
